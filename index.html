    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>점포경영시스템</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <style>
            @font-face { 
                font-family: 'CJOnlyOne'; 
                src: url('/static/CJONLYONENEWbodyRegular.ttf') format('truetype'); 
                font-weight: 400; 
                font-style: normal; 
            }
            @font-face { 
                font-family: 'CJOnlyOne'; 
                src: url('/static/CJONLYONENEWtitleMedium.ttf') format('truetype'); 
                font-weight: 500; 
                font-style: normal; 
            }
            @font-face { 
                font-family: 'CJOnlyOne'; 
                src: url('/static/CJONLYONENEWtitleBold.ttf') format('truetype'); 
                font-weight: 700; 
                font-style: normal; 
            }

            :root {
                --sidebar-bg: #2b303b;
                --main-bg: #f4f6f8;
                --card-bg: #ffffff;
                --text-main: #333333;
                --text-muted: #888888;
                --border-color: #eaedf1;
                --primary-blue: #2563eb;
                --primary-hover: #1d4ed8;
                --danger-red: #ef4444;
                --success-green: #10b981;
                --disabled-bg: #cbd5e1;
                --disabled-text: #64748b;
            }
            
            * { box-sizing: border-box; margin: 0; padding: 0; }
            body { 
                font-family: 'CJOnlyOne', 'Malgun Gothic', sans-serif; 
                background-color: var(--main-bg); 
                color: var(--text-main); 
                height: 100vh; 
                overflow: hidden; 
                letter-spacing: -0.5px; 
            }
            
            /* 로그인 화면 */
            #login-view { 
                display: flex; 
                justify-content: center; 
                align-items: center; 
                height: 100vh; 
                background-color: var(--main-bg); 
            }
            .login-card { 
                background: var(--card-bg); 
                padding: 40px; 
                border-radius: 12px; 
                box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
                width: 400px; 
                text-align: center; 
            }
            .login-card h2 { margin-bottom: 24px; color: var(--sidebar-bg); font-size: 24px; font-weight: 700; }
            .login-card i.logo-icon { font-size: 40px; color: var(--primary-blue); margin-bottom: 15px; }
            
            .input-group { margin-bottom: 15px; text-align: left; }
            .input-group label { display: block; font-size: 13px; color: var(--text-muted); margin-bottom: 5px; font-weight: 500; }
            .input-group input { 
                width: 100%; 
                padding: 12px; 
                border: 1px solid var(--border-color); 
                border-radius: 6px; 
                font-size: 14px; 
                outline: none; 
                font-family: inherit; 
            }
            .btn-login { 
                width: 100%; 
                padding: 14px; 
                background-color: var(--primary-blue); 
                color: white; 
                border: none; 
                border-radius: 6px; 
                font-size: 15px; 
                font-weight: 700; 
                cursor: pointer; 
                margin-top: 10px; 
                font-family: inherit; 
            }
            
            /* 대시보드 레이아웃 */
            #dashboard-view { display: none; height: 100vh; display: flex; }
            .sidebar { 
                width: 80px; 
                background-color: var(--sidebar-bg); 
                display: flex; 
                flex-direction: column; 
                align-items: center; 
                padding-top: 20px; 
            }
            .sidebar-icon { 
                width: 50px; 
                height: 50px; 
                display: flex; 
                justify-content: center; 
                align-items: center; 
                color: #8a94a6; 
                font-size: 20px; 
                margin-bottom: 10px; 
                border-radius: 10px; 
                cursor: pointer; 
            }
            .sidebar-icon.active, .sidebar-icon:hover { 
                background-color: rgba(255,255,255,0.1); 
                color: white; 
            }
            
            .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
            .header { 
                height: 60px; 
                background: var(--card-bg); 
                border-bottom: 1px solid var(--border-color); 
                display: flex; 
                align-items: center; 
                padding: 0 24px; 
                justify-content: space-between; 
            }
            .header-title { font-size: 18px; font-weight: 700; }
            .header-user { font-size: 14px; color: var(--text-muted); display: flex; align-items: center; gap: 15px; font-weight: 500; }
            .btn-logout { 
                background: none; 
                border: 1px solid var(--border-color); 
                padding: 6px 12px; 
                border-radius: 4px; 
                cursor: pointer; 
                color: var(--text-muted); 
                font-size: 13px; 
                font-family: inherit; 
            }

            /* 그리드 및 패널 */
            .content-grid { display: flex; flex: 1; padding: 24px; gap: 24px; overflow: hidden; }
            
            /* 왼쪽 패널 (재고 리스트) */
            .panel-left { flex: 7; display: flex; flex-direction: column; background: var(--main-bg); overflow-y: auto; }
            .list-header { display: flex; gap: 20px; margin-bottom: 15px; font-size: 15px; font-weight: 700; color: var(--text-muted); }
            .list-header span.active { color: var(--primary-blue); border-bottom: 2px solid var(--primary-blue); padding-bottom: 5px; }
            
            .inventory-card { 
                background: var(--card-bg); 
                border-radius: 8px; 
                border: 1px solid var(--border-color); 
                padding: 16px 20px; 
                margin-bottom: 12px; 
                display: flex; 
                align-items: center; 
            }
            .inv-status { 
                width: 60px; 
                height: 60px; 
                border-radius: 50%; 
                border: 2px solid var(--primary-blue); 
                display: flex; 
                flex-direction: column; 
                justify-content: center; 
                align-items: center; 
                color: var(--primary-blue); 
                font-weight: 700; 
                font-size: 12px; 
                margin-right: 20px; 
            }
            .inv-status span { font-size: 18px; }
            .inv-details { flex: 1; }
            .inv-name { font-size: 16px; font-weight: 700; margin-bottom: 5px; }
            .inv-meta { font-size: 13px; color: var(--text-muted); font-weight: 400; }
            .inv-actions { font-size: 14px; font-weight: 500; text-align: right; }
            
            /* 오른쪽 패널 (AI 예측 & LLM 결과) */
            .panel-right { 
                flex: 3; 
                background: var(--card-bg); 
                border-radius: 12px; 
                border: 1px solid var(--border-color); 
                display: flex; 
                flex-direction: column; 
                overflow: hidden; 
            }
            .panel-right-header { padding: 20px; border-bottom: 1px solid var(--border-color); background: #fdfdfd; }
            .panel-right-title { font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
            
            .panel-right-body { padding: 20px; flex: 1; overflow-y: auto; background: var(--main-bg); }
            .info-group { background: var(--card-bg); border-radius: 8px; padding: 20px; margin-bottom: 15px; border: 1px solid var(--border-color); }
            .info-label { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; display: flex; align-items: center; gap: 5px; font-weight: 700; }
            
            .panel-right-footer { padding: 20px; border-top: 1px solid var(--border-color); background: var(--card-bg); display: flex; flex-direction: column; gap: 10px; }
            
            /* 버튼 및 뱃지 스타일 */
            .btn-action { 
                width: 100%; 
                padding: 14px; 
                border: none; 
                border-radius: 6px; 
                font-size: 15px; 
                font-weight: 700; 
                cursor: pointer; 
                text-align: center; 
                font-family: inherit; 
                transition: background 0.2s; 
            }
            .btn-primary { background-color: var(--primary-blue); color: white; }
            .btn-primary:hover { background-color: var(--primary-hover); }
            .btn-success { background-color: var(--success-green); color: white; }
            .btn-success:hover { background-color: #059669; }
            .btn-disabled { background-color: var(--disabled-bg); color: var(--disabled-text); cursor: not-allowed; }

            .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 700; }
            .badge-success { background: #d1fae5; color: #065f46; }
            
            /* 타겟 그룹 푸시 카드 스타일 */
            .push-card { 
                background: white; 
                border: 1px solid #e2e8f0; 
                border-radius: 8px; 
                padding: 15px; 
                margin-bottom: 12px; 
                box-shadow: 0 2px 4px rgba(0,0,0,0.02); 
            }
            .push-card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
                padding-bottom: 8px;
                border-bottom: 1px dashed #e2e8f0;
            }
            .discount-tag {
                font-size: 13px;
                color: var(--danger-red);
                font-weight: 800;
                background: #fee2e2;
                padding: 4px 8px;
                border-radius: 4px;
            }
            .target-tag {
                font-size: 12px;
                color: #64748b;
                font-weight: 500;
            }
        </style>
    </head>
    <body>
        <div id="login-view">
            <div class="login-card">
                <i class="fa-solid fa-store logo-icon"></i>
                <h2>점포경영시스템</h2>
                <div class="input-group">
                    <label>Store ID</label>
                    <input type="text" id="storeId" placeholder="예: 8050091306">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="password" placeholder="비밀번호 (0000)">
                </div>
                <button class="btn-login" onclick="login()">로그인</button>
            </div>
        </div>

        <div id="dashboard-view">
            <div class="sidebar">
                <div class="sidebar-icon active"><i class="fa-solid fa-list-check"></i></div>
                <div class="sidebar-icon"><i class="fa-solid fa-chart-line"></i></div>
                <div class="sidebar-icon"><i class="fa-solid fa-box-open"></i></div>
            </div>

            <div class="main-content">
                <div class="header">
                    <div class="header-title"><i class="fa-solid fa-bars" style="color: var(--text-muted); margin-right: 10px;"></i> 통합 점포 관리</div>
                    <div class="header-user">
                        <span id="display-store-id"><i class="fa-solid fa-location-dot"></i> </span>
                        <button class="btn-logout" onclick="logout()"><i class="fa-solid fa-arrow-right-from-bracket"></i> 로그아웃</button>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="panel-left">
                        <div class="list-header">
                            <span class="active"><i class="fa-solid fa-boxes-stacked"></i> 전체 재고</span>

                        </div>
                        <div id="inventory-list"></div>
                    </div>

                    <div class="panel-right">
                        <div class="panel-right-header">
                            <div class="panel-right-title"><i class="fa-solid fa-microchip" style="color: var(--primary-blue);"></i> Zero Waste AI </div>
                        </div>
                        
                        <div class="panel-right-body">
                            <div class="info-group">
                                <div class="info-label"><i class="fa-solid fa-chart-pie"></i> 예측 결과 요약</div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="font-size: 14px; color: #666;">오늘 예상 폐기율:</span>
                                    <strong id="res-waste" style="font-size: 20px; color: var(--danger-red);">-</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 14px; color: #666;">마감세일 알림:</span>
                                    <span id="res-trigger" class="badge" style="background: #e2e8f0; color: #64748b;">대기 중</span>
                                </div>
                            </div>

                            <div class="info-group" style="padding: 0; background: transparent; border: none;">
                                <div class="info-label" style="margin-bottom: 10px;"><i class="fa-solid fa-wand-magic-sparkles"></i> 고객 맞춤형 마감세일 쿠폰</div>
                                <div id="res-copy">
                                    <div style="background: white; border: 1px dashed var(--border-color); border-radius: 8px; padding: 30px 20px; text-align: center; color: var(--text-muted); font-size: 13px;">
                                        <i class="fa-solid fa-robot" style="font-size: 24px; margin-bottom: 10px; color: #cbd5e1;"></i><br>
                                        오늘 남을 것으로 예상되는 빵이 많다면,<br>AI가 맞춤 고객을 찾아 마감 할인 쿠폰을 발송해 드려요.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel-right-footer">
                            <button class="btn-action btn-primary" id="trigger-btn" onclick="runTrigger()">
                                <i class="fa-solid fa-bolt"></i> 1단계: 오늘 남을 빵 예측하기
                            </button>
                            <button class="btn-action btn-disabled" id="btn-send-coupon" disabled onclick="sendCoupon()">
                                <i class="fa-solid fa-paper-plane"></i> 2단계: 마감 할인 쿠폰 발송
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let targetProductId = "";

            window.onload = function() {
                const savedStoreId = localStorage.getItem('store_id');
                const savedStoreName = localStorage.getItem('store_name_clean');
                
                if (savedStoreId) {
                    // 저장된 정보가 있으면 바로 대시보드 표시
                    showDashboard(savedStoreId, savedStoreName);
                }
            };

            async function login() {
                const storeId = document.getElementById('storeId').value;
                const password = document.getElementById('password').value;
                if (!storeId || !password) return alert("입력해주세요.");

                try {
                    const response = await fetch('/api/login', { 
                        method: 'POST', 
                        headers: { 'Content-Type': 'application/json' }, 
                        body: JSON.stringify({ store_id: storeId, password: password }) 
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        localStorage.setItem('store_id', data.store_id);
                        localStorage.setItem('store_name_clean', data.store_name_clean);
                        showDashboard(data.store_id, data.store_name_clean);
                    } else {
                        const err = await response.json();
                        alert(err.detail);
                    }
                } catch (e) { alert("서버 연결 실패"); }
            }

            function logout() {
                localStorage.removeItem('store_id');
                localStorage.removeItem('store_name_clean');
                location.reload(); 
            }

            function showDashboard(storeId, storeName) {
                document.getElementById('login-view').style.display = 'none';
                document.getElementById('dashboard-view').style.display = 'flex';
                
                // ⭐ 점포명 표시 핵심 로직 (이름이 없거나 UNKNOWN이면 번호만, 있으면 이름과 번호 같이 출력)
                let displayText = `점포번호: ${storeId}`;
                if (storeName && storeName !== "UNKNOWN") {
                    displayText = `${storeName} (ID: ${storeId})`;
                }
                document.getElementById('display-store-id').innerHTML = `<i class="fa-solid fa-store"></i> ${displayText}`;
                
                loadInventory(storeId);
            }

            async function loadInventory(storeId) {
                try {
                    const response = await fetch(`/api/inventory/${storeId}`);
                    const data = await response.json();
                    const listContainer = document.getElementById('inventory-list');
                    listContainer.innerHTML = '';
                    
                    if (data.inventory.length === 0) {
                        listContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-muted);">현재 등록된 재고가 없습니다.</div>';
                        return;
                    }

                    data.inventory.forEach(item => {
                        const stockClass = item.stock < 10 ? 'color: var(--danger-red); font-weight: bold;' : '';
                        listContainer.innerHTML += `
                            <div class="inventory-card">
                                <div class="inv-status"><span style="font-size: 14px;">${item.stock}개</span></div>
                                <div class="inv-details">
                                    <div class="inv-name">${item.name}</div>
                                    <div class="inv-meta">ID: ${item.product_id}</div>
                                </div>
                                <div class="inv-actions">
                                    당일 생산: ${item.daily_production}개<br>
                                    <span style="${stockClass}">현재 재고: ${item.stock}개</span>
                                </div>
                            </div>`;
                    });
                } catch (e) {
                    console.error("재고 로드 실패:", e);
                }
            }

            async function runTrigger() {
                const btn = document.getElementById('trigger-btn');
                const sendBtn = document.getElementById('btn-send-coupon');
                const copyBox = document.getElementById('res-copy');
                
                btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> 오늘 남을 빵 예측 분석 중...';
                btn.style.backgroundColor = "#94a3b8";
                
                try {
                    const response = await fetch('/api/trigger-test', { 
                        method: 'POST', 
                        headers: { 'Content-Type': 'application/json' }, 
                        body: JSON.stringify({ store_id: localStorage.getItem('store_id') }) 
                    });
                    const result = await response.json();
                    
                    if (result.status === "success") {
                        document.getElementById('res-waste').innerText = result.waste_rate + '%';
                        
                        const triggerSpan = document.getElementById('res-trigger');
                        
                        if (result.trigger_coupon) {
                            triggerSpan.innerText = "발송 권장";
                            triggerSpan.className = "badge badge-success";
                            
                            targetProductId = result.target_product_id;
                            
                            sendBtn.disabled = false;
                            sendBtn.className = "btn-action btn-success";
                            
                            copyBox.innerHTML = `
                                <div style="background: white; border: 1px solid var(--primary-blue); border-radius: 8px; padding: 20px; text-align: center;">
                                    <i class="fa-solid fa-bullseye" style="font-size: 24px; color: var(--primary-blue); margin-bottom: 10px;"></i><br>
                                    <span style="color: var(--primary-blue); font-weight: 700; font-size: 14px;">오늘 예측 폐기율이 높습니다!</span><br>
                                    <span style="color: #666; font-size: 13px;">아래 버튼을 눌러 고객에게 마감 할인 쿠폰을 발송하세요.</span>
                                </div>`;
                        } else {
                            triggerSpan.innerText = "발송 보류";
                            triggerSpan.className = "badge";
                            triggerSpan.style.background = "#e2e8f0";
                            triggerSpan.style.color = "#64748b";
                            
                            copyBox.innerHTML = `
                                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; text-align: center; color: #64748b; font-size: 13px;">
                                    폐기율이 안정적이므로<br>마케팅 발송이 불필요합니다.
                                </div>`;
                        }
                    } else {
                        alert("API 통신 오류: " + result.message);
                    }
                } catch (e) {
                    alert("서버 연결에 실패했습니다.");
                } finally {
                    btn.innerHTML = '<i class="fa-solid fa-check"></i> 1단계: 오늘 남을 빵 예측 완료';
                    btn.style.backgroundColor = "var(--primary-blue)";
                }
            }

            async function sendCoupon() {
                const sendBtn = document.getElementById('btn-send-coupon');
                const copyBox = document.getElementById('res-copy');

                sendBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> 마감 할인 쿠폰 발송 중...';
                sendBtn.disabled = true;

                try {
                    const response = await fetch('/api/issue-coupon', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            store_id: localStorage.getItem('store_id'), 
                            product_id: targetProductId 
                        })
                    });

                    const result = await response.json();

                    if (result.status === "success") {
                        let html_str = "";
                        
                        result.results.forEach(g => {
                            html_str += `
                            <div class="push-card">
                                <div class="push-card-header">
                                    <span class="discount-tag">${g.discount}% 할인 혜택</span>
                                    <span class="target-tag"><i class="fa-solid fa-users"></i> ${g.label} </span>
                                </div>
                                <div style="font-weight: 800; font-size: 15px; margin-bottom: 6px; color: #1e293b;">${g.copy.headline}</div>
                                <div style="font-size: 13px; color: #475569; margin-bottom: 12px; line-height: 1.4;">${g.copy.push_text}</div>
                                <div style="font-size: 12px; font-weight: 700; color: var(--primary-blue); display: flex; align-items: center; gap: 5px;">
                                    <i class="fa-solid fa-hand-pointer"></i> ${g.copy.action_line}
                                </div>
                            </div>`;
                        });
                        
                        copyBox.innerHTML = html_str;
                        
                        sendBtn.innerHTML = '<i class="fa-solid fa-database"></i> 마감 할인 쿠폰 발송 완료';
                        sendBtn.className = "btn-action btn-disabled"; 
                        sendBtn.style.color = "#10b981"; 
                    } else {
                        alert("오류 발생: " + result.message);
                        sendBtn.disabled = false;
                        sendBtn.innerHTML = '<i class="fa-solid fa-rotate-right"></i> 2단계: 마감 할인 쿠폰 발송';
                    }
                } catch (e) {
                    alert("서버 통신 에러가 발생했습니다.");
                    sendBtn.disabled = false;
                    sendBtn.innerHTML = '<i class="fa-solid fa-rotate-right"></i> 2단계: 마감 할인 쿠폰 발송';
                }
            }
        </script>
    </body>
    </html>